# Task 1.4: Project Settings Configuration

Navigation: [Design](../design.md) | [PRD](../../../stories/1/prd.md)

## Objective

Update `.claude/settings.json` to register the safety hooks directly (manual installation method), enabling the hooks to run on every tool call.

## Output File

`.claude/settings.json` (create or update)

## Specification

For manual installation (not via plugin marketplace), hooks are registered directly in settings:

```json
{
  "hooks": {
    "PreToolUse": [
      {
        "matcher": "Bash",
        "hooks": [
          {
            "type": "command",
            "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/dangerous-command-guard.sh"
          }
        ]
      },
      {
        "matcher": "Edit|Write|MultiEdit",
        "hooks": [
          {
            "type": "command",
            "command": "$CLAUDE_PROJECT_DIR/.claude/hooks/protected-files-guard.py"
          }
        ]
      }
    ]
  }
}
```

## Field Definitions

| Field | Type | Description |
|-------|------|-------------|
| `hooks` | object | Root hook configuration |
| `hooks.PreToolUse` | array | Array of tool matchers |
| `hooks.PreToolUse[].matcher` | string | Regex pattern for tool names |
| `hooks.PreToolUse[].hooks` | array | Array of hook commands for this matcher |
| `hooks.PreToolUse[].hooks[].type` | string | Hook type, must be `"command"` |
| `hooks.PreToolUse[].hooks[].command` | string | Absolute path or `$CLAUDE_PROJECT_DIR` prefixed path |

## Environment Variables

| Variable | Description |
|----------|-------------|
| `$CLAUDE_PROJECT_DIR` | Resolved to the project root directory at runtime |

## Settings Merge Behavior

If `.claude/settings.json` already exists with other settings, merge the hooks configuration. Existing hooks should be preserved.

## Verification

After configuration, verify hooks are registered:

1. Start Claude Code in the project directory
2. Run `/hooks` command
3. Verify both hooks appear in the list

## Known Issues

From research (`docs/research/claude-safety-hooks-plugin.md:435-437`):
> Changes to hooks in settings files don't take effect immediately in a running session. Review them via `/hooks` menu for changes to apply — this is a security feature.

Users must restart Claude Code or use `/hooks` menu after configuration changes.

## Final Directory Structure

```
.claude/
├── hooks/
│   ├── dangerous-command-guard.sh   # Task 1.1
│   └── protected-files-guard.py     # Task 1.2
├── plugins/
│   └── safety-guard/
│       └── manifest.json            # Task 1.3
└── settings.json                    # This task
```

## Testing

1. Restart Claude Code
2. Run `/hooks` and verify both hooks are listed
3. Test blocked command: try `rm -rf /` and verify block
4. Test ask command: try `git push` and verify confirmation dialog
5. Test blocked file: try editing `.env` and verify block

## Acceptance Criteria

- [ ] File is valid JSON
- [ ] PreToolUse array contains both hook configurations
- [ ] Bash matcher configured for dangerous-command-guard.sh
- [ ] Edit|Write|MultiEdit matcher configured for protected-files-guard.py
- [ ] Paths use `$CLAUDE_PROJECT_DIR` prefix
- [ ] Hook type is `"command"` for both
- [ ] Existing settings (if any) are preserved
